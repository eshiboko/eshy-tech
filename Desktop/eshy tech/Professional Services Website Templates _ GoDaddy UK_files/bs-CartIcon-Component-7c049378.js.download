define("@widget/LAYOUT/bs-CartIcon-Component-7c049378.js",["exports","@widget/LAYOUT/c/bs-_rollupPluginBabelHelpers","@widget/LAYOUT/c/bs-dataAids","@widget/LAYOUT/c/bs-index","@widget/LAYOUT/c/bs-_commonjsHelpers","@widget/LAYOUT/c/bs-utils2","@widget/LAYOUT/c/bs-navigation","@widget/LAYOUT/c/bs-Toggle","@widget/LAYOUT/c/bs-index2","@widget/LAYOUT/bs-FlyoutMenu-Component"],(function(e,t,o,a,r,l,s,g,n,i){"use strict";class c extends(global.React||guac.react).Component{constructor(e){super(e),t._defineProperty(this,"setupOlaCart",async()=>{const{websiteId:e,rootDomain:t}=this.props;if(!this.gopayCart)try{const o=!!window.sessionStorage;if(!await l.getGoPayCartFF({shouldUseCache:o,websiteId:e,rootDomain:t}))return;this.setState({olaGopayCartOn:!0}),this.gopayCart=await l.lib.cartSetup({websiteId:e,hostName:t}),this.updateOlaStoreState(),this.gopayCartUnsubscribe=this.gopayCart.subscribe(this.updateOlaStoreState)}catch(e){this.gopayCart=null,this.setState({olaGopayCartOn:!1})}}),t._defineProperty(this,"updateOlaStoreState",()=>{if(!this.gopayCart)return;const{quantitiesByType:e}=this.gopayCart.getState(),t=e.service||0;this.setState({olaQuantity:t})}),t._defineProperty(this,"updateOlsStoreState",()=>{this.setState({olsProvisioned:(global.OLSCore||guac["@wsb/guac-widget-ols-core"]).OlsConfigStore.isProvisioned()});const{olsQuantity:e}=this.state,{cart:t}=(global.OLSCore||guac["@wsb/guac-widget-ols-core"]).CartStore.getState(),o=t?t.total_quantity:0;o!==e&&this.setState({olsQuantity:o},window.dispatchEvent.bind(null,new Event("CartQuantityChange")))}),t._defineProperty(this,"onStoreChange",()=>{(global.OLSCore||guac["@wsb/guac-widget-ols-core"]).Logger.debug("OLS: HeaderCartIcon.onStoreChange");const e=(global.OLSCore||guac["@wsb/guac-widget-ols-core"]).OlsConfigStore.isProvisioned();!this.state.olsProvisioned&&e&&((global.OLSCore||guac["@wsb/guac-widget-ols-core"]).Logger.debug("OLS: HeaderCartIcon.onStoreChange - store is provisioned"),setTimeout(()=>{(global.OLSCore||guac["@wsb/guac-widget-ols-core"]).CartActions.loadCart()},0)),this.updateOlsStoreState()}),t._defineProperty(this,"renderItemCount",()=>{const e=l.getCountStyles(this.props.category);return 0===this.totalCartQuantity?null:(global.React||guac.react).createElement((global.Core||guac["@wsb/guac-widget-core"]).UX2.Element.Block,{style:{...e.wrapper,marginLeft:"!-6px"},"data-aid":o.DataAid.CART_ICON_COUNT},(global.React||guac.react).createElement((global.Core||guac["@wsb/guac-widget-core"]).UX2.Element.Details.Minor,{style:{...e.count,color:"inherit"},featured:!0},(global.OLSCore||guac["@wsb/guac-widget-ols-core"]).NumberFormatter.toFormattedNumber(this.totalCartQuantity)))}),t._defineProperty(this,"handleOlsClick",()=>{(global.OLSCore||guac["@wsb/guac-widget-ols-core"]).Logger.debug("OLS: CartIcon.handleOlsClick"),(global.OLSCore||guac["@wsb/guac-widget-ols-core"]).RouteHandler.navigate((global.OLSCore||guac["@wsb/guac-widget-ols-core"]).ShopViewConstants.CART),(global.OLSCore||guac["@wsb/guac-widget-ols-core"]).ScrollWidgetActions.scrollShopWidget()}),t._defineProperty(this,"getOlsLinkProps",()=>{const{isShopPage:e,shopPageId:t,shopRoute:o,domainName:a,renderMode:r,pageRoute:l}=this.props;return e?{onClick:this.handleOlsClick,href:"#",convertToAbsolute:!1}:{href:"".concat(o,"?").concat(s.CART_PARAMS),"data-page":t,"data-page-query":s.CART_PARAMS,renderMode:r,domainName:a,pageRoute:l}}),t._defineProperty(this,"getOlaLinkProps",()=>this.props.renderMode!==(global.Core||guac["@wsb/guac-widget-core"]).constants.renderModes.PUBLISH?{}:{onClick:()=>this.gopayCart.toggle(),href:"#"}),t._defineProperty(this,"getIconLinkProps",()=>this.enabledForOls&&!this.enabledForOla?this.getOlsLinkProps():this.enabledForOla&&!this.enabledForOls?this.getOlaLinkProps():{}),t._defineProperty(this,"renderDropdown",()=>{const{staticContent:e={},sidebarWidth:a}=this.props,{olaQuantity:r,olsQuantity:s}=this.state,g={dropdown:{position:"absolute",right:"0",top:"large",whiteSpace:"nowrap",maxHeight:"45vh",overflowY:"auto",display:"none",zIndex:"20",listStyle:"none","@md":{...a?{right:"auto",top:"auto",left:"0",bottom:"large"}:{}}},listItem:{display:"block",textAlign:"left",marginBottom:"0"},link:{display:"flex",alignItems:"center"},separator:{marginTop:"small",marginBottom:"small"},countLabel:{marginLeft:"xsmall"}},n=l.getCountStyles(this.props.category);return(global.React||guac.react).createElement((global.Core||guac["@wsb/guac-widget-core"]).UX2.Element.Dropdown,{section:"default",tag:"ul",role:"menu",id:this.dropdownToggleId,style:g.dropdown,"data-aid":o.DataAid.CART_DROPDOWN_RENDERED},(global.React||guac.react).createElement((global.Core||guac["@wsb/guac-widget-core"]).UX2.Element.ListItem,{tag:"li",role:"menuitem",key:"cart-dropdown-ols-item",style:g.listItem},(global.React||guac.react).createElement((global.Core||guac["@wsb/guac-widget-core"]).UX2.Element.Link,t._extends({},this.getOlsLinkProps(),{style:g.link}),(global.React||guac.react).createElement((global.Core||guac["@wsb/guac-widget-core"]).UX2.Element.Block,{style:n.wrapper},(global.React||guac.react).createElement((global.Core||guac["@wsb/guac-widget-core"]).UX2.Element.Details.Minor,{style:n.count,featured:!0},s)),(global.React||guac.react).createElement((global.Core||guac["@wsb/guac-widget-core"]).UX2.Element.Details,{style:g.countLabel},e.cartProducts))),(global.React||guac.react).createElement((global.Core||guac["@wsb/guac-widget-core"]).UX2.Element.ListItem,{style:g.listItem},(global.React||guac.react).createElement((global.Core||guac["@wsb/guac-widget-core"]).UX2.Element.HR,{style:g.separator})),(global.React||guac.react).createElement((global.Core||guac["@wsb/guac-widget-core"]).UX2.Element.ListItem,{tag:"li",role:"menuitem",key:"cart-dropdown-ola-item",style:g.listItem},(global.React||guac.react).createElement((global.Core||guac["@wsb/guac-widget-core"]).UX2.Element.Link,t._extends({},this.getOlaLinkProps(),{style:g.link}),(global.React||guac.react).createElement((global.Core||guac["@wsb/guac-widget-core"]).UX2.Element.Block,{style:n.wrapper},(global.React||guac.react).createElement((global.Core||guac["@wsb/guac-widget-core"]).UX2.Element.Details.Minor,{style:n.count,featured:!0},r)),(global.React||guac.react).createElement((global.Core||guac["@wsb/guac-widget-core"]).UX2.Element.Details,{style:g.countLabel},e.cartServices))))}),t._defineProperty(this,"cartRouter",()=>{const{staticContent:e={}}=this.props,a={menu:{position:"relative"},link:{display:"flex",alignItems:"center"}};return this.shouldRenderDropdown?(global.React||guac.react).createElement((global.Core||guac["@wsb/guac-widget-core"]).UX2.Element.Block,{style:a.menu},(global.React||guac.react).createElement(i.default,{renderCustomContent:(global.React||guac.react).createElement((global.Core||guac["@wsb/guac-widget-core"]).UX2.Element.Block,{style:a.link},this.renderIcon(),this.renderItemCount()),toggleId:this.dropdownToggleId,dataAid:o.DataAid.CART_ICON_RENDER,renderMode:this.props.renderMode}),this.renderDropdown()):(global.React||guac.react).createElement((global.Core||guac["@wsb/guac-widget-core"]).UX2.Element.Link,t._extends({style:a.link,"aria-label":e.cartIcon||"Shopping Cart Icon",convertToAbsolute:!0},this.getIconLinkProps()),this.renderIcon(),this.renderItemCount())}),this.state={olsQuantity:0,olaQuantity:0,olsProvisioned:!1,olaGopayCartOn:!1},this.dropdownToggleId="cart-dropdown-".concat(+new Date)}componentDidMount(){(global.OLSCore||guac["@wsb/guac-widget-ols-core"]).Logger.debug("OLS: HeaderCartIcon.componentDidMount"),this.enabledForOls&&(this.updateOlsStoreState(),(global.OLSCore||guac["@wsb/guac-widget-ols-core"]).CartStore.addListener("change",this.onStoreChange),(global.OLSCore||guac["@wsb/guac-widget-ols-core"]).OlsConfigStore.addListener("change",this.onStoreChange),(global.OLSCore||guac["@wsb/guac-widget-ols-core"]).OlsConfigActions.setConfig(this.props),(global.OLSCore||guac["@wsb/guac-widget-ols-core"]).OlsConfigActions.loadConfig(),(global.OLSCore||guac["@wsb/guac-widget-ols-core"]).OlsConfigStore.isProvisioned()&&(global.OLSCore||guac["@wsb/guac-widget-ols-core"]).CartActions.loadCart()),this.hasOlaWidget&&this.setupOlaCart()}componentWillUnmount(){(global.OLSCore||guac["@wsb/guac-widget-ols-core"]).Logger.debug("OLS: HeaderCartIcon.componentWillUnmount"),this.enabledForOls&&((global.OLSCore||guac["@wsb/guac-widget-ols-core"]).CartStore.removeListener("change",this.onStoreChange),(global.OLSCore||guac["@wsb/guac-widget-ols-core"]).OlsConfigStore.removeListener("change",this.onStoreChange)),this.enabledForOla&&this.gopayCart&&this.gopayCartUnsubscribe&&this.gopayCartUnsubscribe()}get hasOlaWidget(){return!!this.props.appointmentsPageId}get enabledForOls(){return!!this.props.shopPageId}get enabledForOla(){return this.hasOlaWidget&&this.state.olaGopayCartOn}get shouldRender(){return this.enabledForOls||this.enabledForOla}get totalCartQuantity(){const{olsQuantity:e,olaQuantity:t}=this.state;return e+t}get shouldRenderDropdown(){return this.enabledForOls&&this.enabledForOla}renderIcon(){const{cartStyles:e}=this.props;return(global.React||guac.react).createElement((global.Core||guac["@wsb/guac-widget-core"]).UX2.Element.Icon,{icon:"cart1",style:e,"data-aid":o.DataAid.CART_ICON_RENDER,size:a.ICON_SIZE,minTarget:!0})}render(){if((global.OLSCore||guac["@wsb/guac-widget-ols-core"]).Logger.debug("OLS: CartIcon.render"),!this.shouldRender)return null;return(global.React||guac.react).createElement((global.Core||guac["@wsb/guac-widget-core"]).UX2.Element.Block,{style:{display:"flex",alignItems:"center",fontSize:"xsmall"},children:this.cartRouter()})}}c.propTypes={category:(global.PropTypes||guac["prop-types"]).string,sidebarWidth:(global.PropTypes||guac["prop-types"]).number,isShopPage:(global.PropTypes||guac["prop-types"]).bool,appointmentsPageId:(global.PropTypes||guac["prop-types"]).string,shopPageId:(global.PropTypes||guac["prop-types"]).string,shopRoute:(global.PropTypes||guac["prop-types"]).string,accountId:(global.PropTypes||guac["prop-types"]).string,websiteId:(global.PropTypes||guac["prop-types"]).string,olsStatus:(global.PropTypes||guac["prop-types"]).string,olsAccountStatus:(global.PropTypes||guac["prop-types"]).string,env:(global.PropTypes||guac["prop-types"]).string,renderMode:(global.PropTypes||guac["prop-types"]).string,rootDomain:(global.PropTypes||guac["prop-types"]).string,domainName:(global.PropTypes||guac["prop-types"]).string,pageRoute:(global.PropTypes||guac["prop-types"]).string,cartStyles:(global.PropTypes||guac["prop-types"]).object,isReseller:(global.PropTypes||guac["prop-types"]).bool,staticContent:(global.PropTypes||guac["prop-types"]).object},e.default=c})),"undefined"!=typeof window&&(window.global=window);
